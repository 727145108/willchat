{"version":3,"sources":["base.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["var Base = function ($) {\r\n    // ajax 提交表单\r\n    var initAjaxForm = function () {\r\n        // 表单默认以AJAX提交并提示处理结果，提升用户体验，如果不要AJAX提交则在form添加no-ajax类\r\n        $(\"form\").not('.validate').submit(function (event) {\r\n            var url = $(this).attr('action');\r\n            var submitData = $(this).serialize();\r\n            $.ajax({\r\n                url: url,\r\n                type: 'POST',\r\n                dataType: 'json',\r\n                data: submitData,\r\n            }).done(function (data, textStatus, jqXHR) {\r\n                var formItem = $('form');\r\n                // 清除旧的错误提示\r\n                formItem.find('.alert').remove();\r\n                this.success(data.info);\r\n                if (data.url) {\r\n                    setTimeout(function () {\r\n                        top.location.href = data.url\r\n                    }, 2000);\r\n                } else {\r\n                    setTimeout(function () {\r\n                        top.location.reload()\r\n                    }, 2000);\r\n                }\r\n            }).fail(function (jqXHR, textStatus, errorThrown) {\r\n                var errors = jqXHR.responseJSON;\r\n                var formItem = $('form');\r\n                // 清除旧的错误提示\r\n                formItem.find('.alert').remove();\r\n                $.each(errors, function (index, val) {\r\n                    var errorMsg = val[0];\r\n                    var errorAlert = $(\"<div class=\\\"alert alert-danger alert-dismissable\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\" aria-hidden=\\\"true\\\"></button><strong>验证错误!</strong> \" + errorMsg + \" </div>\");\r\n                    formItem.prepend(errorAlert);\r\n                });\r\n            }).always(function () {\r\n                console.log(\"complete\");\r\n            });\r\n            return false;\r\n        });\r\n    };\r\n\r\n    //图片弹出预览\r\n    var initImgpreview = function () {\r\n        $('img.preview-small,.thumbnail img').click(function (event) {\r\n            event.preventDefault();\r\n\r\n            var imgSrc = $(this).attr('src');\r\n            var imgItem = \"<img src='\" + imgSrc + \"' height='300'/>\";\r\n            top.layer.open({\r\n                type: 1,\r\n                title: false,\r\n                fix: false,\r\n                shadeClose: true,\r\n                offset: ['150px', ''],\r\n                area: ['auto', 'auto'],\r\n                content: imgItem\r\n            });\r\n        });\r\n    };\r\n\r\n    // table 行全选\r\n    var initCheckAll = function () {\r\n        //全选的实现\r\n        $(\".group-checkable\").click(function () {\r\n            $(\".ids\").prop(\"checked\", this.checked);\r\n            $('.group-checkable,.ids').uniform()\r\n        });\r\n        $(\".ids\").click(function () {\r\n            var option = $(\".ids\");\r\n            option.each(function (i) {\r\n                if (!this.checked) {\r\n                    $(\".group-checkable\").prop(\"checked\", false);\r\n                    $('.group-checkable,.ids').uniform()\r\n                    return false;\r\n                } else {\r\n                    $(\".group-checkable\").prop(\"checked\", true);\r\n                    $('.group-checkable,.ids').uniform()\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    // ajax get请求\r\n    $('.ajax-get').click(function () {\r\n        var target;\r\n        var that = this;\r\n        if ($(this).hasClass('confirm')) {\r\n            if (!confirm('确认要执行该操作吗?')) {\r\n                return false;\r\n            }\r\n        }\r\n        if ((target = $(this).attr('href')) || (target = $(this).attr('url'))) {\r\n            $.get(target).success(function (data) {\r\n                if (data.status == 1) {\r\n                    if (data.url) {\r\n                        this.success(data.info + ' 页面即将自动跳转~');\r\n                    } else {\r\n                        this.success(data.info);\r\n                    }\r\n                    setTimeout(function () {\r\n                        if (data.url) {\r\n                            location.href = data.url;\r\n                        } else {\r\n                            location.reload();\r\n                        }\r\n                    }, 1500);\r\n                } else {\r\n                    this.error(data.info);\r\n                    setTimeout(function () {\r\n                        if (data.url) {\r\n                            location.href = data.url;\r\n                        }\r\n                    }, 1500);\r\n                }\r\n            });\r\n        }\r\n        return false;\r\n    });\r\n\r\n    // ajax post submit请求\r\n    $('.ajax-post').click(function () {\r\n        var target, query, form;\r\n        var target_form = $(this).attr('target-form');\r\n        var that = this;\r\n        var nead_confirm = false;\r\n        if (($(this).attr('type') == 'submit') || (target = $(this).attr('href')) || (target = $(this).attr('url'))) {\r\n            form = $('.' + target_form);\r\n            if ($(this).attr('hide-data') === 'true') { //无数据时也可以使用的功能\r\n                form = $('.hide-data');\r\n                query = form.serialize();\r\n            } else if (form.get(0) == undefined) {\r\n                return false;\r\n            } else if (form.get(0).nodeName == 'FORM') {\r\n                if ($(this).hasClass('confirm')) {\r\n                    if (!confirm('确认要执行该操作吗?')) {\r\n                        return false;\r\n                    }\r\n                }\r\n                if ($(this).attr('url') !== undefined) {\r\n                    target = $(this).attr('url');\r\n                } else {\r\n                    target = form.get(0).action;\r\n                }\r\n                query = form.serialize();\r\n            } else if (form.get(0).nodeName == 'INPUT' || form.get(0).nodeName == 'SELECT' || form.get(0).nodeName == 'TEXTAREA') {\r\n                form.each(function (k, v) {\r\n                    if (v.type == 'checkbox' && v.checked == true) {\r\n                        nead_confirm = true;\r\n                    }\r\n                });\r\n                if (nead_confirm && $(this).hasClass('confirm')) {\r\n                    if (!confirm('确认要执行该操作吗?')) {\r\n                        return false;\r\n                    }\r\n                }\r\n                query = form.serialize();\r\n            } else {\r\n                if ($(this).hasClass('confirm')) {\r\n                    if (!confirm('确认要执行该操作吗?')) {\r\n                        return false;\r\n                    }\r\n                }\r\n                query = form.find('input,select,textarea').serialize();\r\n            }\r\n            $(that).addClass('disabled').attr('autocomplete', 'off').prop('disabled', true);\r\n            $.post(target, query).success(function (data) {\r\n                if (data.status == 1) {\r\n                    if (data.url) {\r\n                        this.success(data.info + ' 页面即将自动跳转~');\r\n                    } else {\r\n                        this.success(data.info);\r\n                    }\r\n                    setTimeout(function () {\r\n                        $(that).removeClass('disabled').prop('disabled', false);\r\n                        if (data.url) {\r\n                            location.href = data.url;\r\n                        } else {\r\n                            location.reload();\r\n                        }\r\n                    }, 1500);\r\n                } else {\r\n                    this.error(data.info);\r\n                    setTimeout(function () {\r\n                        $(that).removeClass('disabled').prop('disabled', false);\r\n                        if (data.url) {\r\n                            location.href = data.url;\r\n                        }\r\n                    }, 1500);\r\n                }\r\n            });\r\n        }\r\n        return false;\r\n    });\r\n\r\n    // 侧栏高亮,rewrite URL模式匹配\r\n    var highlightSidebar = function () {\r\n        //侧栏菜单中的全部有链接菜单项\r\n        var sidebarLinks = $(\".sidebar-menu\").find('.treeview a');\r\n\r\n        if (sidebarLinks.length > 0) {\r\n            //当前页面URL\r\n            var url = document.URL;\r\n\r\n            var activeMenuItem = $(\".sidebar-menu .treeview\").find(\"a[href='\" + url + \"']\").first();\r\n\r\n            if (activeMenuItem) {\r\n                //保存当前高亮菜单项 index 到 cookie 中\r\n                var menuIndex = sidebarLinks.index(activeMenuItem);\r\n\r\n                activeMenuItem.parents(\".treeview\").addClass(\"active\");\r\n                activeMenuItem.parent('li').addClass(\"active\");\r\n\r\n                Cookies.set('menuindex', menuIndex);\r\n            } else {\r\n                //侧栏中没有与当前 URL 匹配的，则高亮上一次高亮的项\r\n                var menuIndex = Cookies.get('menuindex');\r\n\r\n                activeMenuItem = sidebarLinks.eq(menuIndex);\r\n\r\n                activeMenuItem.parents(\".treeview\").addClass(\"active\");\r\n                activeMenuItem.parent('li').addClass(\"active\");\r\n            }\r\n        }\r\n    };\r\n\r\n    // 上传文件对话框\r\n    var initUploadfile = function () {\r\n        $('.btn-uploadfile').on('click', function () {\r\n            var triggerItem=$(this); //触发弹出层的元素\r\n            var data=triggerItem.data();\r\n            top.dialog({\r\n                id: 'dialog-uplpadfile',\r\n                title: '上传文件',\r\n                fixed:true,\r\n                quickClose: true,\r\n                padding: 10,\r\n                data: data,\r\n                zIndex: 99999,\r\n                url: \"{:U('User/Dialog/uploadfile',array('token'=>$token))}\",\r\n                okValue: '确定',\r\n                cancelValue: '取消',\r\n                ok: function() {\r\n                    if (this.data.filepath) {\r\n                        var picControl=triggerItem.parents('.pic-control');\r\n                        //更新输入框值\r\n                        picControl.find(\"input.pic-path\").val(this.data.filepath);\r\n                        //更新预览图片\r\n                        picControl.find(\"img\").attr(\"src\", \"__ROOT__\"+this.data.filepath);\r\n                    };\r\n                    this.close().remove();\r\n                },\r\n                cancel: function() {\r\n                }\r\n            })\r\n                .show();\r\n            return false;\r\n        });\r\n    };\r\n\r\n    var initPopupDialog = function () {\r\n        // 弹出编辑框\r\n        $('.popup').on('click', function () {\r\n            var triggerItem = $(this); //触发弹出层的元素\r\n            var data = triggerItem.data();\r\n            var url = $(this).attr('href');\r\n            var area = ['500px', '350px'];\r\n            //不同尺寸弹出窗\r\n            if($(this).hasClass('popup-large')){\r\n                area = ['750px', '500px'];\r\n            }else if($(this).hasClass('popup-mediun')){\r\n                area = ['500px', '350px'];\r\n            }else if($(this).hasClass('popup-small')){\r\n                area = ['350px', '200px'];\r\n            }\r\n            top.layer.open({\r\n                title: ' ',\r\n                type: 2,\r\n                shift: 2,\r\n                fixed: true,\r\n                area: area,\r\n                shadeClose: false, //开启遮罩关闭\r\n                content: url,\r\n                duccess: function(){\r\n                    console.log();\r\n                }\r\n            });\r\n            return false;\r\n        });\r\n    };\r\n\r\n    // 操作成功提示\r\n    var success = function (msg) {\r\n        top.layer.msg(msg, {\r\n            icon: 1\r\n        });\r\n    };\r\n\r\n    // 操作失败提示\r\n    var error = function (msg) {\r\n        top.layer.msg(msg, {\r\n            icon: 2,\r\n            shift: 6\r\n        });\r\n    };\r\n\r\n    // 一般提示\r\n    var info = function (msg) {\r\n        top.layer.msg(msg);\r\n    };\r\n\r\n    // 操作确认弹窗\r\n    var confirm = function (msg, callback) {\r\n        top.layer.confirm(msg, {icon: 3, title: '操作提示'}, function (index) {\r\n            callback();\r\n            top.layer.close(index);\r\n        });\r\n    };\r\n\r\n    // 显示 loading 提示层\r\n    var showLoading = function () {\r\n        this.loadingIndex = top.layer.load();\r\n    };\r\n\r\n    // 隐藏 loading 提示层\r\n    var hideLoading = function () {\r\n        top.layer.close(this.loadingIndex);\r\n    };\r\n\r\n    // 主页左侧栏菜单自动高亮\r\n    var highlightProfileSidebar = function () {\r\n        var navItem = $('#dashboard-sidebar').find('.list-group');\r\n\r\n        if (navItem.size() <= 0) {\r\n            return;\r\n        }\r\n\r\n        var highligntSidemenu = function (index) {\r\n            navItem.children('.list-group-item').eq(index).addClass('active').siblings().removeClass('active');\r\n        };\r\n\r\n        var pathname = window.location.pathname;\r\n\r\n        if (pathname.match(/user\\/(profile|avatar)/)) {\r\n            highligntSidemenu(1);\r\n        } else if (pathname.match(/user\\/document/)) {\r\n            highligntSidemenu(2);\r\n        } else {\r\n            highligntSidemenu(0);\r\n        }\r\n    };\r\n\r\n    return {\r\n        initNormalPage: function () {\r\n            initAjaxForm();\r\n            initImgpreview();\r\n            initCheckAll();\r\n            highlightSidebar();\r\n            highlightProfileSidebar();\r\n            initPopupDialog();\r\n            initUploadfile();\r\n        },\r\n        initDialogPage: function () {\r\n            initAjaxForm();\r\n            initCheckAll();\r\n        },\r\n        success: success,\r\n        error: error,\r\n        info: info,\r\n        confirm: confirm,\r\n        showLoading: showLoading,\r\n        hideLoading: hideLoading\r\n    }\r\n}(jQuery);\r\n\r\njQuery(document).ready(function () {\r\n    $.ajaxSetup({\r\n        headers: {\r\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\r\n        }\r\n    });\r\n\r\n    $(document).ajaxStart(function () {\r\n        Base.showLoading();\r\n    }).ajaxStop(function () {\r\n        Base.hideLoading();\r\n    });\r\n});"],"sourceRoot":"/source/"}